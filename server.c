/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "IDL.h"
#include <stdio.h>
#include <ctype.h>
#include <dirent.h>
#include <errno.h>
#include <fcntl.h>
#include <libgen.h>
#include <limits.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>

const char * rootpath = "/home/localadmin/finalproject/bbfs_server/serverpoint";

static void * getfullpath(char fpath[PATH_MAX], const char * path){
  strcpy(fpath, rootpath);
  strncat(fpath, path, PATH_MAX);
}

int *
getattr_10_svc(getattr_IDL *argp, struct svc_req *rqstp)
{
	static int  result;
	struct stat * statbuf = (struct stat*)malloc(sizeof(struct stat));
	char fpath[PATH_MAX];
	getfullpath(fpath, argp->path);
	printf("full path is %s\n", fpath);
	result = lstat(fpath, statbuf);
	argp->st_dev = statbuf->st_dev;
	argp->st_ino = statbuf->st_ino;
	argp->st_mode = statbuf->st_mode;
	argp->st_nlink = statbuf->st_nlink;
	argp->st_uid = statbuf->st_uid;
	argp->st_gid = statbuf->st_gid;
	argp->st_rdev = statbuf->st_rdev;
	argp->st_size = statbuf->st_size;
	argp->st_blksize = statbuf->st_blksize;
	argp->st_blocks = statbuf->st_blocks;
	argp->st_atim = statbuf->st_atime;
	argp->st_mtim = statbuf->st_mtime;
	argp->st_ctim = statbuf->st_ctime;
	printf("server mode is %3o\n", statbuf->st_mode);
	printf("mode sent back is %3lo\n", argp->st_mode);
	/*
	 * insert server code here
	 */
	free(statbuf);
	return &result;
}

int *
mkdir_10_svc(mkdir_IDL *argp, struct svc_req *rqstp)
{
	static int result;
	char fpath[PATH_MAX];
	getfullpath(fpath, argp->path);
	printf("argp->path is: %s\n", argp->path);
	//printf("argp->path_p is: %s\n", *argp->path_p);
	printf("%s, mode is %3o\n", fpath, argp->mode);
	//uint32_t fmode = argp->mode & 0777;
        result = mkdir(fpath, argp->mode);
	printf("mkdir result is: %d\n", result);
	/*
	 * insert server code here
	 */

	return &result;
}

int *
rmdir_10_svc(rmdir_IDL *argp, struct svc_req *rqstp)
{
	static int  result;
	char fpath[PATH_MAX];
        getfullpath(fpath, argp->path);
        printf("remove %s\n", fpath);
        //uint32_t fmode = argp->mode & 0777;                                                                    
        result = rmdir(fpath);
        printf("result is %d\n", result);
	/*
	 * insert server code here
	 */
	return &result;
}

int *
open_10_svc(open_IDL *argp, struct svc_req *rqstp)
{
	static int  result;

	/*
	 * insert server code here
	 */

	return &result;
}

int *
read_10_svc(read_IDL *argp, struct svc_req *rqstp)
{
	static int  result;

	/*
	 * insert server code here
	 */

	return &result;
}

int *
write_10_svc(write_IDL *argp, struct svc_req *rqstp)
{
	static int  result;

	/*
	 * insert server code here
	 */

	return &result;
}

int *
opendir_10_svc(opendir_IDL *argp, struct svc_req *rqstp)
{
	static int  result;

	/*
	 * insert server code here
	 */

	return &result;
}

int *
readdir_10_svc(readdir_IDL *argp, struct svc_req *rqstp)
{
	static int  result;

	/*
	 * insert server code here
	 */

	return &result;
}

void *
hellotest_10_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;
	printf("*****************************\n");
	printf("HELLO!!!!!!!!!!!!!\n");
	printf("*****************************\n");
	return (void *) &result;
}
